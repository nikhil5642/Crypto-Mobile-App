import * as React from 'react'
import {useState} from 'react'

import {FlatList, View, Text} from 'react-native'

import {styles} from './screener.style'

export const Screener = () => {
  const [dataList, setDataList] = useState([
    {
      id: 1,
      name: 'Bitcoin',
      symbol: 'BTC',
      slug: 'bitcoin',
      num_market_pairs: 9126,
      date_added: '2013-04-28T00:00:00.000Z',
      tags: [
        'mineable',
        'pow',
        'sha-256',
        'store-of-value',
        'state-channel',
        'coinbase-ventures-portfolio',
        'three-arrows-capital-portfolio',
        'polychain-capital-portfolio',
        'binance-labs-portfolio',
        'blockchain-capital-portfolio',
        'boostvc-portfolio',
        'cms-holdings-portfolio',
        'dcg-portfolio',
        'dragonfly-capital-portfolio',
        'electric-capital-portfolio',
        'fabric-ventures-portfolio',
        'framework-ventures-portfolio',
        'galaxy-digital-portfolio',
        'huobi-capital-portfolio',
        'alameda-research-portfolio',
        'a16z-portfolio',
        '1confirmation-portfolio',
        'winklevoss-capital-portfolio',
        'usv-portfolio',
        'placeholder-ventures-portfolio',
        'pantera-capital-portfolio',
        'multicoin-capital-portfolio',
        'paradigm-portfolio',
      ],
      max_supply: 21000000,
      circulating_supply: 18952362,
      total_supply: 18952362,
      platform: null,
      cmc_rank: 1,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 3221161.7915661465,
          volume_24h: 2367315562853.7246,
          volume_change_24h: 19.7536,
          percent_change_1h: -0.10451005,
          percent_change_24h: -2.38867608,
          percent_change_7d: 9.56646122,
          percent_change_30d: 2.34992225,
          percent_change_60d: -10.25159661,
          percent_change_90d: -36.74841656,
          market_cap: 61048624334330.16,
          market_cap_dominance: 41.6593,
          fully_diluted_market_cap: 67644397622889.336,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 1027,
      name: 'Ethereum',
      symbol: 'ETH',
      slug: 'ethereum',
      num_market_pairs: 5488,
      date_added: '2015-08-07T00:00:00.000Z',
      tags: [
        'mineable',
        'pow',
        'smart-contracts',
        'ethereum-ecosystem',
        'binance-smart-chain',
        'coinbase-ventures-portfolio',
        'three-arrows-capital-portfolio',
        'polychain-capital-portfolio',
        'binance-labs-portfolio',
        'blockchain-capital-portfolio',
        'boostvc-portfolio',
        'cms-holdings-portfolio',
        'dcg-portfolio',
        'dragonfly-capital-portfolio',
        'electric-capital-portfolio',
        'fabric-ventures-portfolio',
        'framework-ventures-portfolio',
        'hashkey-capital-portfolio',
        'kenetic-capital-portfolio',
        'huobi-capital-portfolio',
        'alameda-research-portfolio',
        'a16z-portfolio',
        '1confirmation-portfolio',
        'winklevoss-capital-portfolio',
        'usv-portfolio',
        'placeholder-ventures-portfolio',
        'pantera-capital-portfolio',
        'multicoin-capital-portfolio',
        'paradigm-portfolio',
      ],
      max_supply: null,
      circulating_supply: 119498631.9365,
      total_supply: 119498631.9365,
      platform: null,
      cmc_rank: 2,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 228659.22720651646,
          volume_24h: 1246740020429.7258,
          volume_change_24h: 15.9954,
          percent_change_1h: -0.05410215,
          percent_change_24h: -2.99812961,
          percent_change_7d: 8.56256521,
          percent_change_30d: -3.43444743,
          percent_change_60d: -23.27026675,
          percent_change_90d: -36.35128445,
          market_cap: 27324464830836.035,
          market_cap_dominance: 18.6389,
          fully_diluted_market_cap: 27324464830836.254,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 825,
      name: 'Tether',
      symbol: 'USDT',
      slug: 'tether',
      num_market_pairs: 27469,
      date_added: '2015-02-25T00:00:00.000Z',
      tags: [
        'payments',
        'stablecoin',
        'asset-backed-stablecoin',
        'binance-smart-chain',
        'avalanche-ecosystem',
        'solana-ecosystem',
        'moonriver-ecosystem',
      ],
      max_supply: null,
      circulating_supply: 77922851073.84462,
      total_supply: 80074697052.59753,
      platform: {
        id: 1027,
        name: 'Ethereum',
        symbol: 'ETH',
        slug: 'ethereum',
        token_address: '0xdac17f958d2ee523a2206206994597c13d831ec7',
      },
      cmc_rank: 3,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 74.76793049202962,
          volume_24h: 5263056061196.087,
          volume_change_24h: 16.4542,
          percent_change_1h: -0.18608665,
          percent_change_24h: 0.04365809,
          percent_change_7d: -1.38008234,
          percent_change_30d: 0.05866859,
          percent_change_60d: 0.00730821,
          percent_change_90d: 0.04445682,
          market_cap: 5826130312829.989,
          market_cap_dominance: 3.9757,
          fully_diluted_market_cap: 5987019383398.985,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 1839,
      name: 'BNB',
      symbol: 'BNB',
      slug: 'bnb',
      num_market_pairs: 673,
      date_added: '2017-07-25T00:00:00.000Z',
      tags: [
        'marketplace',
        'centralized-exchange',
        'payments',
        'smart-contracts',
        'binance-smart-chain',
        'alameda-research-portfolio',
        'multicoin-capital-portfolio',
        'moonriver-ecosystem',
      ],
      max_supply: 165116760,
      circulating_supply: 165116760.89,
      total_supply: 165116760.89,
      platform: null,
      cmc_rank: 4,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 31032.68442441356,
          volume_24h: 148202094770.57904,
          volume_change_24h: 20.3072,
          percent_change_1h: -0.67511213,
          percent_change_24h: -4.82049552,
          percent_change_7d: 6.05427783,
          percent_change_30d: -5.65922611,
          percent_change_60d: -26.83375664,
          percent_change_90d: -35.41747052,
          market_cap: 5124016333880.721,
          market_cap_dominance: 3.4966,
          fully_diluted_market_cap: 5124016306261.775,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 3408,
      name: 'USD Coin',
      symbol: 'USDC',
      slug: 'usd-coin',
      num_market_pairs: 2947,
      date_added: '2018-10-08T00:00:00.000Z',
      tags: [
        'medium-of-exchange',
        'stablecoin',
        'asset-backed-stablecoin',
        'binance-smart-chain',
        'fantom-ecosystem',
        'moonriver-ecosystem',
      ],
      max_supply: null,
      circulating_supply: 51577576398.35253,
      total_supply: 51577576398.35253,
      platform: {
        id: 1027,
        name: 'Ethereum',
        symbol: 'ETH',
        slug: 'ethereum',
        token_address: '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48',
      },
      cmc_rank: 5,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 74.6844758334964,
          volume_24h: 282221744872.5667,
          volume_change_24h: 15.2714,
          percent_change_1h: -0.1712759,
          percent_change_24h: -0.00693593,
          percent_change_7d: -1.44125411,
          percent_change_30d: -0.10961618,
          percent_change_60d: -0.08129566,
          percent_change_90d: -0.04869809,
          market_cap: 3852044258073.074,
          market_cap_dominance: 2.6286,
          fully_diluted_market_cap: 3852044258072.8237,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 52,
      name: 'XRP',
      symbol: 'XRP',
      slug: 'xrp',
      num_market_pairs: 677,
      date_added: '2013-08-04T00:00:00.000Z',
      tags: [
        'medium-of-exchange',
        'enterprise-solutions',
        'binance-chain',
        'arrington-xrp-capital-portfolio',
        'galaxy-digital-portfolio',
        'a16z-portfolio',
        'pantera-capital-portfolio',
      ],
      max_supply: 100000000000,
      circulating_supply: 47832461678,
      total_supply: 99989769444,
      platform: null,
      cmc_rank: 6,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 61.057385851987576,
          volume_24h: 435543252895.0756,
          volume_change_24h: 73.3547,
          percent_change_1h: 0.21252361,
          percent_change_24h: 3.49744529,
          percent_change_7d: 29.04611346,
          percent_change_30d: 7.67365453,
          percent_change_60d: -0.66508713,
          percent_change_90d: -38.11576574,
          market_cap: 2920525068924.055,
          market_cap_dominance: 1.9922,
          fully_diluted_market_cap: 6105738585199.034,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 2010,
      name: 'Cardano',
      symbol: 'ADA',
      slug: 'cardano',
      num_market_pairs: 362,
      date_added: '2017-10-01T00:00:00.000Z',
      tags: [
        'mineable',
        'dpos',
        'pos',
        'platform',
        'research',
        'smart-contracts',
        'staking',
        'binance-smart-chain',
        'cardano-ecosystem',
        'cardano',
      ],
      max_supply: 45000000000,
      circulating_supply: 33592757060.783,
      total_supply: 34066349127.639,
      platform: null,
      cmc_rank: 7,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 85.77576718024919,
          volume_24h: 168985100986.8085,
          volume_change_24h: 19.0201,
          percent_change_1h: -0.48825349,
          percent_change_24h: -3.50130643,
          percent_change_7d: 5.29949955,
          percent_change_30d: -3.83107201,
          percent_change_60d: -8.97553005,
          percent_change_90d: -48.79748437,
          market_cap: 2881444508588.3945,
          market_cap_dominance: 1.9655,
          fully_diluted_market_cap: 3859909523111.0303,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 5426,
      name: 'Solana',
      symbol: 'SOL',
      slug: 'solana',
      num_market_pairs: 248,
      date_added: '2020-04-10T00:00:00.000Z',
      tags: [
        'pos',
        'platform',
        'solana-ecosystem',
        'cms-holdings-portfolio',
        'kenetic-capital-portfolio',
        'alameda-research-portfolio',
        'multicoin-capital-portfolio',
        'okex-blockdream-ventures-portfolio',
      ],
      max_supply: null,
      circulating_supply: 317331753.48264843,
      total_supply: 511616946.142289,
      platform: null,
      cmc_rank: 8,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 8343.23339325241,
          volume_24h: 199726942630.80902,
          volume_change_24h: 17.3742,
          percent_change_1h: 0.2414743,
          percent_change_24h: -7.44960935,
          percent_change_7d: -1.27169818,
          percent_change_30d: -22.86504007,
          percent_change_60d: -35.66818129,
          percent_change_90d: -53.68472159,
          market_cap: 2647572882395.774,
          market_cap_dominance: 1.8067,
          fully_diluted_market_cap: 4268539589607.977,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 4172,
      name: 'Terra',
      symbol: 'LUNA',
      slug: 'terra-luna',
      num_market_pairs: 144,
      date_added: '2019-07-26T00:00:00.000Z',
      tags: [
        'cosmos-ecosystem',
        'store-of-value',
        'defi',
        'payments',
        'coinbase-ventures-portfolio',
        'binance-labs-portfolio',
        'solana-ecosystem',
        'arrington-xrp-capital-portfolio',
        'hashkey-capital-portfolio',
        'kenetic-capital-portfolio',
        'huobi-capital-portfolio',
        'pantera-capital-portfolio',
        'terra-ecosystem',
      ],
      max_supply: null,
      circulating_supply: 401301571.5100442,
      total_supply: 818524069.550756,
      platform: null,
      cmc_rank: 9,
      self_reported_circulating_supply: null,
      self_reported_market_cap: null,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 4224.2974594467905,
          volume_24h: 158132440807.13974,
          volume_change_24h: 12.4438,
          percent_change_1h: 0.84413474,
          percent_change_24h: -1.93963982,
          percent_change_7d: 7.04558359,
          percent_change_30d: -22.84416548,
          percent_change_60d: -11.94827,
          percent_change_90d: 4.79451247,
          market_cap: 1695217209001.8843,
          market_cap_dominance: 1.1568,
          fully_diluted_market_cap: 3457689147499.498,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
    {
      id: 6636,
      name: 'Polkadot',
      symbol: 'DOT',
      slug: 'polkadot-new',
      num_market_pairs: 304,
      date_added: '2020-08-19T00:00:00.000Z',
      tags: [
        'substrate',
        'polkadot',
        'binance-chain',
        'binance-smart-chain',
        'polkadot-ecosystem',
        'three-arrows-capital-portfolio',
        'polychain-capital-portfolio',
        'arrington-xrp-capital-portfolio',
        'blockchain-capital-portfolio',
        'boostvc-portfolio',
        'cms-holdings-portfolio',
        'coinfund-portfolio',
        'fabric-ventures-portfolio',
        'fenbushi-capital-portfolio',
        'hashkey-capital-portfolio',
        'kenetic-capital-portfolio',
        '1confirmation-portfolio',
        'placeholder-ventures-portfolio',
        'pantera-capital-portfolio',
        'exnetwork-capital-portfolio',
        'web3',
        'spartan-group',
      ],
      max_supply: null,
      circulating_supply: 987579314.957085,
      total_supply: 1103303471.382273,
      platform: null,
      cmc_rank: 10,
      self_reported_circulating_supply: 904869778,
      self_reported_market_cap: 19277446112.93815,
      last_updated: '2022-02-08T18:27:00.000Z',
      quote: {
        INR: {
          price: 1591.8261880927575,
          volume_24h: 109788278423.66345,
          volume_change_24h: 18.6241,
          percent_change_1h: -0.05781724,
          percent_change_24h: -5.52001883,
          percent_change_7d: 6.23641243,
          percent_change_30d: -14.34249351,
          percent_change_60d: -19.1778072,
          percent_change_90d: -58.10003934,
          market_cap: 1572054616367.3933,
          market_cap_dominance: 1.0728,
          fully_diluted_market_cap: 1756267359159.7349,
          last_updated: '2022-02-08T18:28:03.000Z',
        },
      },
    },
  ])
  if (dataList.length === 0) {
    fetchLiveData(setDataList)
  }
  return (
    <View style={styles.container}>
      <FlatList
        data={dataList}
        renderItem={liveItem}
        keyExtractor={(item) => item.name}
      />
    </View>
  )
}

function fetchLiveData(setDataList: any) {
  const myHeaders = new Headers()
  myHeaders.append('X-CMC_PRO_API_KEY', '8ac04e5d-477c-44c4-a58e-3e4f82e3253f')

  const requestOptions = {
    method: 'GET',
    headers: myHeaders,
  }

  fetch(
    'https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?convert=INR&start=1&limit=10',
    requestOptions,
  )
    .then((response) => response.json())
    .then((res) => {
      loadDataSuccess(res.data, setDataList)
    })
    .catch((err) => {
      loadDataFailure(err)
    })
}

function loadDataSuccess(data: any, setDataList: any) {
  const items: any[] = []
  data.forEach((item) => {
    items.push(item)
  })
  setDataList(items)
}

function loadDataFailure(error: any) {
  console.log('error received', error)
}

const liveItem = ({item}) => {
  return (
    <View style={styles.rowContainer}>
      <Text style={styles.name}>{item.name}</Text>
      <Text style={styles.price}>
        Rs. {item.quote.INR.price.toLocaleString()}
      </Text>
    </View>
  )
}
